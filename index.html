<!-- THIS IS THE CODE FOR YOUR index.html FILE -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SLoots Rewards</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --tg-bg: var(--tg-theme-bg-color, #121212); --tg-text: var(--tg-theme-text-color, #fff); --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #1e1e1e); --tg-button: var(--tg-theme-button-color, #8774E1); }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 0; padding-bottom: 70px; background-color: var(--tg-bg); color: var(--tg-text); }
        .page { display: none; padding: 20px; }
        .page.active { display: block; }
        .nav { position: fixed; bottom: 0; left: 0; right: 0; display: flex; background-color: var(--tg-secondary-bg); border-top: 1px solid #333; z-index: 100; }
        .nav-btn { flex-grow: 1; padding: 12px; text-align: center; background: none; border: none; color: var(--tg-text); opacity: 0.7; font-size: 14px; cursor: pointer; border-top: 3px solid transparent; }
        .nav-btn.active { color: var(--tg-button); opacity: 1; border-top-color: var(--tg-button); }
        .header { text-align: center; margin-bottom: 20px; }
        .fren-list { list-style: none; padding: 0; }
        .fren-item { display: flex; align-items: center; justify-content: space-between; background-color: var(--tg-secondary-bg); padding: 15px; border-radius: 10px; margin-bottom: 10px; }
        .fren-name { font-weight: bold; }
        #wallet-balance { font-size: 28px; font-weight: bold; color: var(--tg-button); }
    </style>
</head>
<body>
    <div id="frens-page" class="page active">
        <div class="header"><h2>Invite Friends</h2><p>You get a bonus for every friend that joins!</p></div>
        <h3>Your Friends (<span id="fren-count">0</span>)</h3>
        <ul id="fren-list" class="fren-list"><li id="frens-loading">Loading friends...</li></ul>
    </div>
    <div id="earn-page" class="page"><h2>Earn More Coins</h2><p>Daily tasks coming soon!</p></div>
    <div id="wallet-page" class="page"><h2>Your Wallet</h2><p>Balance: <strong id="wallet-balance">...</strong></p><p>Withdrawals coming soon!</p></div>
    <nav class="nav">
        <button class="nav-btn active" onclick="showPage('frens-page')">Frens</button>
        <button class="nav-btn" onclick="showPage('earn-page')">Earn</button>
        <button class="nav-btn" onclick="showPage('wallet-page')">Wallet</button>
    </nav>
    <script>
        // ⚠️ YOU MUST EDIT THIS ONE LINE BELOW WITH YOUR NGROK URL ⚠️
        const API_BASE_URL = "YOUR_NGROK_URL_HERE"; 

        const tg = window.Telegram.WebApp;
        const user = tg.initDataUnsafe?.user;

        function showPage(pageId) {
            document.querySelectorAll('.page, .nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelector(`.nav-btn[onclick="showPage('${pageId}')"]`).classList.add('active');
        }

        async function fetchData() {
            if (!user) { document.body.innerHTML = '<h1>Please open from Telegram.</h1>'; return; }
            try {
                const [userDataRes, frensDataRes] = await Promise.all([
                    fetch(`${API_BASE_URL}/api/get_user_data?user_id=${user.id}`),
                    fetch(`${API_BASE_URL}/api/get_referrals?user_id=${user.id}`)
                ]);
                const userData = await userDataRes.json();
                const frensData = await frensDataRes.json();
                updateUI(userData, frensData);
            } catch (error) {
                console.error("Failed to fetch data:", error);
                document.getElementById('frens-loading').innerText = 'Could not connect to server. Is ngrok running?';
            }
        }
        
        function updateUI(userData, frens) {
            document.getElementById('wallet-balance').textContent = `${userData.points || 0} Coins`;
            const listElement = document.getElementById('fren-list');
            const countElement = document.getElementById('fren-count');
            listElement.innerHTML = '';
            if (frens.length === 0) {
                listElement.innerHTML = '<li>You have not invited any friends yet.</li>';
            } else {
                frens.forEach(frenName => {
                    const item = document.createElement('li');
                    item.className = 'fren-item';
                    item.innerHTML = `<span class="fren-name">${frenName}</span><span style="color:green;">✔</span>`;
                    listElement.appendChild(item);
                });
            }
            countElement.textContent = frens.length;
        }

        tg.ready();
        tg.expand();
        fetchData();
    </script>
</body>
</html>